function managePricing(n,t,i,r,u){i.PricingDetails={};i.discountAmount=null;i.discountType=0;i.valuationID="";i.valuation="";i.discountP=0;i.discountV=0;i.crewArray=[2,3];i.additionalFee=null;i.finaldiscountAmount=0;i.CalculateHourly=function(){var u;i.personPrice=i.PricingDetails.QuotePriceDetails.PERSON_PRICE_MULTIPLIER;i.truckPrice=i.PricingDetails.QuotePriceDetails.TRUCK_PRICE_MULTIPLIER;i.personPriceDestination=i.PricingDetails.QuotePriceDetails.PERSON_DESTINATION_MULTIPLIER;i.truckPriceDestination=i.PricingDetails.QuotePriceDetails.TRUCK_DESTINATION_MULTIPLIER;i.currentHour=i.PricingDetails.QuotePriceDetails.CURRENT_HOUR;var n=i.personPrice*i.PricingDetails.QuotePriceDetails.CrewSize+i.truckPrice*i.PricingDetails.QuotePriceDetails.Trucks,r=i.personPriceDestination*i.PricingDetails.QuotePriceDetails.CrewSize+i.PricingDetails.QuotePriceDetails.Trucks*i.truckPriceDestination+n,f=parseInt(i.additionalFee);f&&(r+=f);u=(i.PricingDetails.QuotePriceDetails.HourlyData.CustomerTimeEstimate-1)*n+r+0;i.estimatedHourlyPrice=t.formatCurrency(u);i.estimatedTotal=t.formatCurrency(u);i.firstHour=t.formatCurrency(r);i.firstHourLinePrice=t.formatCurrency(r)+" first hour";i.extraHours=t.formatCurrency(n);i.hourlyLinePrice=t.formatCurrency(n)+" /hour";i.$parent.UpdateQuicklook()};i.SetDiscountPriority=function(n,t){i.discountType=n;i.discountAmount=t;i.ApplyAdjustments()};i.ChangeValuation=function(){for(var n=0;n<i.PricingDetails.ReplacementValuationOptionsGuaranteed.length;n++)if(i.PricingDetails.ReplacementValuationOptionsGuaranteed[n].ValuationTypeID==i.valuationID){i.valuation=i.PricingDetails.ReplacementValuationOptionsGuaranteed[n];i.ApplyAdjustments();break}};i.ApplyAdjustments=function(){if(i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount=i.PricingDetails.QuotePriceDetails.GuaranteedPrice,i.discountType==="value")i.discountAmount&&(i.finaldiscountAmount=parseInt(i.discountAmount)),i.discountP=i.finaldiscountAmount/i.PricingDetails.QuotePriceDetails.GuaranteedPrice*100,i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount=i.PricingDetails.QuotePriceDetails.GuaranteedPrice+parseInt(i.discountAmount);else if(i.discountType==="percent"){var n=i.PricingDetails.QuotePriceDetails.GuaranteedPrice/100;n=n*i.discountAmount;i.discountV=n;i.finaldiscountAmount=n;i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount=i.PricingDetails.QuotePriceDetails.GuaranteedPrice+n}i.valuation!=""&&(i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount=i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount+i.valuation.Cost)};i.SaveGuranteed=function(){var r=i.$parent.selectedQuote.QuoteID,u=parseInt(i.finaldiscountAmount),f=i.PricingDetails.QuotePriceDetails.PricingTrucks,e=i.valuationID,t=0;i.discountType=="percent"&&(t=i.discountP);n.SetDiscountPriority(i.$parent.selectedQuote.Lookup,i.discountType,t).then(function(){},function(){});n.SaveGuranteed(r,u,f,null,e,"",null).then(function(){i.$parent.UpdateQuicklook()},function(){})};i.SaveHourly=function(){n.SaveHourly(i.$parent.selectedQuote.QuoteID,i.PricingDetails.QuotePriceDetails.Trucks,i.PricingDetails.QuotePriceDetails.CrewSize,i.PricingDetails.QuotePriceDetails.HourlyData.CustomerTimeEstimate,"","",i.PricingDetails.ReplacementValuationOptionsGuaranteed[1].ValuationTypeID).then(function(){i.$parent.UpdateQuicklook()},function(){})};i.HourlyTruckChange=function(){i.crewArray=[];for(var n=i.PricingDetails.QuotePriceDetails.Trucks*2;n<=i.PricingDetails.QuotePriceDetails.Trucks*3;n++)n==i.PricingDetails.QuotePriceDetails.Trucks*2&&(i.PricingDetails.QuotePriceDetails.CrewSize=parseInt(n)),i.crewArray.push(parseInt(n));i.CalculateHourly()};i.HourlyCrewChange=function(){i.CalculateHourly()};i.HourlyEstimatedChange=function(){i.CalculateHourly()};i.GetPriceDetails=function(){n.GetPriceDetails(i.$parent.selectedQuote.Lookup).then(function(n){var r=n,t;if(i.PricingDetails=r,i.PricingDetails.QuotePriceDetails.TotalTime=i.PricingDetails.QuotePriceDetails.TotalTime,i.PricingDetails.QuotePriceDetails.TotalTime=u.Math.floor(i.PricingDetails.QuotePriceDetails.TotalTime)+" - "+u.Math.ceil(i.PricingDetails.QuotePriceDetails.TotalTime)+" Hours ",i.$parent.selectedQuote.PricingDetails=i.PricingDetails,i.PricingDetails.QuotePriceDetails.GuaranteeData.GuaranteedPriceDiscount=i.PricingDetails.QuotePriceDetails.GuaranteedPrice,i.PricingDetails.DiscountType=="0"?(i.discountV=i.PricingDetails.QuotePriceDetails.GuaranteeData.Adjustments,i.finaldiscountAmount=i.PricingDetails.QuotePriceDetails.GuaranteeData.Adjustments,i.SetDiscountPriority("value",i.PricingDetails.QuotePriceDetails.GuaranteeData.Adjustments)):(i.discountP=i.PricingDetails.AdjustmentPercentage,i.SetDiscountPriority("percent",i.PricingDetails.AdjustmentPercentage)),i.PricingDetails.QuotePriceDetails.HourlyData)for(i.PricingDetails.QuotePriceDetails.HourlyData.CustomerTimeEstimate||(i.PricingDetails.QuotePriceDetails.HourlyData.CustomerTimeEstimate=1),i.additionalFee=i.PricingDetails.QuotePriceDetails.PricingType==="Hourly"?i.PricingDetails.QuotePriceDetails.HourlyData.FirstHourPrice-i.PricingDetails.QuotePriceDetails.HourlyData.HourlyPrice-i.PricingDetails.QuotePriceDetails.GetDefaultDestinationFee():"0",t=i.PricingDetails.QuotePriceDetails.Trucks*2;t<=i.PricingDetails.QuotePriceDetails.Trucks*3;t++)i.crewArray.push(parseInt(t));i.CalculateHourly()},function(){alert("Error : manage pricing - getpricedetails")})};i.Init=function(){i.GetPriceDetails()};i.Init()}quoteApp.controller("managePricing",["priceFactory","utilityFactory","$scope","$element","$window","$timeout",managePricing]);