function manageInventory(n,t,i,r,u){t.Boxes=[];t.CustomBoxes=[];t.selectedRoom={};t.selectedItem={};t.selectedStop={};t.tempOption={};t.searchQuery="";t.searchQuantity=1;t.searchStore=1;t.AllRooms=[];t.AllInventories=[];t.ClearRoomBox=function(){t.selectedRoom={};t.selectedRoom.Items=[];t.selectedRoom.Boxes=[]};t.SetAllRooms=function(){t.$parent.RefreshStops().then(function(){t.AllRooms=[];for(var n=0;n<t.$parent.selectedQuote.Stops.length;n++)t.AllRooms=t.AllRooms.concat(t.$parent.selectedQuote.Stops[n].rooms);t.InitInventory();t.GetUnassignedRoom()})};t.InitInventory=function(){var n,f,r,e,o,i,u;for(t.AllInventories=[],n=0;n<t.AllRooms.length;n++)for(f=!1,r=0;r<t.AllRooms[n].Items.length;r++){for(e=t.AllRooms[n].Items[r].Item.Name,o=t.AllRooms[n].Items[r].Count,i=0;i<t.AllInventories.length;i++)if(t.AllInventories[i].Name===e){t.AllInventories[i].Count=t.AllInventories[i].Count+o;f=!0;break}f||(u={},u.Name=e,u.Count=o,t.AllInventories.push(u))}};t.InventoryItems=function(){n.GetInventoryItems(t.selectedQuote.Lookup).then(function(){},function(){alert("Error in quote home - loading inventory")})};t.onDrop=function(n,i,r){t.ChangeInventoryRoom(i,r)};t.ChangeInventoryRoom=function(i,r){var o,f,u,e,s,h;for(t.roomToDropItem=r,t.inventoryItemstoDrag=i,t.roomToDropItem.Items.push(t.inventoryItemstoDrag),o=0,f=0;f<t.AllRooms.length;f++)t.AllRooms[f].RoomID==t.roomToDropItem.RoomID&&(t.AllRooms[f]=t.roomToDropItem,o=f);for(u=0;u<t.AllRooms.length;u++)for(e=0;e<t.AllRooms[u].Items.length;e++)t.AllRooms[u].Items[e].RoomInverntoryItemID==i.RoomInverntoryItemID&&u!=o&&t.AllRooms[u].Items.splice(e,1);s=JSON.stringify(t.AllRooms);h=t.$parent.selectedQuote.QuoteID;n.UpdateInventory(h,s).then(function(){},function(){alert("Error")})};t.AddItem=function(){var i,r,u,f;for(t.searchQuantity==""&&(t.searchQuantity=1),t.searchStore==""&&(t.searchStore=1),i={},i.Count=t.searchQuantity,i.StorageCount=t.searchStore,i.Item=t.selectedItem,t.selectedRoom.Items.push(i),r=0;r<t.AllRooms.length;r++)t.AllRooms[r].RoomID==t.selectedRoom.RoomID&&(t.AllRooms[r]=t.selectedRoom,u=JSON.stringify(t.AllRooms),f=t.$parent.selectedQuote.QuoteID,n.UpdateInventory(f,u).then(function(){t.$parent.UpdateQuicklook()},function(){t.$parent.RefreshStops();alert("Error")}))};t.SetSelectedRoom=function(n){t.selectedRoom=n};t.UpdateRoom=function(){var i,r,u;for(t.selectedRoom.Type=="Other"&&(t.selectedRoom.Type=t.selectedRoom.TypeOther),t.selectedStop={},i=0;i<t.$parent.selectedQuote.Stops.length;i++)if(t.selectedRoom.StopID===t.$parent.selectedQuote.Stops[i].id){t.selectedStop=t.$parent.selectedQuote.Stops[i];break}t.AllRooms.push(t.selectedRoom);r=JSON.stringify(t.AllRooms);u=t.$parent.selectedQuote.QuoteID;n.UpdateInventory(u,r).then(function(){t.SetAllRooms();t.Init()})};t.GetItemSuggestions=function(){i.find("#searchtxt").autocomplete({source:n.searchItems,select:function(i,r){for(var f=0;f<n.searchItems.length;f++)if(r.item.value==n.InventoryList[f].Name)return t.selectedItem=n.InventoryList[f],t.searchQuery=r.item.value,t.ItemAdditionalOptions(),u(function(){t.$apply()}),!1;return!1}})};t.GetUnassignedRoom=function(){for(var r,n,u=!1,i=0;i<t.AllRooms.length;i++)if(t.AllRooms[i].Sort==9999){for(u=!0,t.selectedRoom=t.AllRooms[i],r=0;r<t.$parent.selectedQuote.Stops.length;r++)t.$parent.selectedQuote.Stops[r].id==t.AllRooms[i].StopID&&(t.selectedStop=t.$parent.selectedQuote.Stops[r]);break}u||(n={},n.Type="Unassigned",n.Description="",n.StopID=t.$parent.selectedQuote.Stops[0].id,n.Sort=9999,n.IsUnassigned=!0,n.Items=[],n.Boxes=[],t.selectedRoom=n,t.selectedStop=t.$parent.selectedQuote.Stops[0],t.AllRooms.push(n))};t.ItemAdditionalOptions=function(){var n,u,e,o,s,f,h,c;if(t.selectedItem.AdditionalQuestions.length>0){for(i.find("#options").empty(),n=0;n<t.selectedItem.AdditionalQuestions.length;n++){if(u="divQuestion_"+n,e=$('<div style="width:500px" id="'+u+'"> <\/div>'),e.appendTo(i.find("#options")),o=$('<label style="float:left;width:200px" for="'+n+'" >'+t.selectedItem.AdditionalQuestions[n].QuestionText+": <\/label>"),o.appendTo(i.find("#"+u)),t.selectedItem.AdditionalQuestions[n].Options.length>0)for(s=$('<select class="form-control">').appendTo("#"+u),f=0;f<t.selectedItem.AdditionalQuestions[n].Options.length;f++)s.append($("<option>").attr("value",f).text(t.selectedItem.AdditionalQuestions[n].Options[f].Option));else h=$('<input type="checkbox" name="check'+n+'" id="check'+n+'" />'),h.appendTo(i.find("#"+u));c=$("<br/>");c.appendTo(i.find("#options"))}r.OpenDialogT("additionalQuestions-modal")}};t.SaveItemOptions=function(){r.CloseDialogT("additionalQuestions-modal");for(var n=0;n<t.selectedItem.AdditionalQuestions.length;n++)t.selectedItem.AdditionalQuestions[n].Options.length==0&&(t.selectedItem.AdditionalQuestions[n].value==!1||typeof t.selectedItem.AdditionalQuestions[n].value=="undefined")&&t.selectedItem.AdditionalQuestions.splice(n,1)};t.ChangeOption=function(n){for(var r,u,i=0;i<t.selectedItem.AdditionalQuestions.length;i++)for(r=0;r<t.selectedItem.AdditionalQuestions[i].Options.length;r++)if(n.OptionID===t.selectedItem.AdditionalQuestions[i].Options[r].OptionID){for(u=0;u<t.selectedItem.AdditionalQuestions[i].Options.length;u++)t.selectedItem.AdditionalQuestions[i].Options[u].Selected=!1;t.selectedItem.AdditionalQuestions[i].Options[r].Selected=!0;break}};t.RemoveItem=function(i){for(var u,f,e,r=0;r<t.selectedRoom.Items.length;r++)t.selectedRoom.Items[r].RoomInverntoryItemID===i.RoomInverntoryItemID&&t.selectedRoom.Items.splice(r,1);for(u=0;u<t.AllRooms.length;u++)t.AllRooms[u].RoomID==t.selectedRoom.RoomID&&(t.AllRooms[u]=t.selectedRoom,f=JSON.stringify(t.AllRooms),e=t.$parent.selectedQuote.QuoteID,n.UpdateInventory(e,f).then(function(){t.$parent.UpdateQuicklook()},function(){alert("Error")}))};t.Init=function(){t.SetAllRooms();t.ClearRoomBox();t.searchQuery="";t.searchQuantity="";t.searchStore="";t.InventoryItems()};t.Init()}quoteApp.controller("manageInventory",["inventoryFactory","$scope","$element","$window","$timeout",manageInventory]);