function manageSchedule(n,t,i){t.selectedDate=null;t.selectedMonth=null;t.selectedYear=null;t.scheduleForQuote=null;t.scheduleDay=!1;t.model={};t.model.rangestart="";t.model.rangeend="";t.model.movers="";t.model.HasCard=!1;t.rangestart=5;t.rangeend=5;t.movers=2;t.ScheduleQuote=function(){t.model.rangestart=t.rangestart;t.model.rangeend=t.rangeend;t.model.movers=t.movers;t.model.paymentType="NO_CARD";t.model.quoteid=t.$parent.selectedQuote.QuoteID;n.ScheduleJob(t.$parent.selectedQuote.QuoteID,t.model).then(function(){t.GetAllQuotesForDate()},function(){alert("manageSchedule - scheduleFactory.ScheduleJob")})};t.GetAllQuotesForDate=function(){n.GetQuotesPerDay(t.$parent.selectedQuote.Lookup,t.selectedDate,t.selectedMonth,t.selectedYear).then(function(n){t.scheduleForQuote=n;t.scheduleDay=!0;t.model.day=t.scheduleForQuote.Date},function(){alert("manageSchedule - scheduleFactory.GetAllQuotes")})};t.OpenSchedule=function(n){t.model.crew=n+1};t.getEventMonth=function(t,r,u){n.GetScheduleForMonth(t,r,u).then(function(n){for(var t,o=[],f=0;f<n.length;f++){var r={},u={},e={};r={};r.total=0;u={};u.total=0;var s=moment.unix(n[f].start).date(),h=moment.unix(n[f].start).month(),c=s+" "+h;if(o.indexOf(c)==-1){for(o.push(c),t=0;t<n.length;t++)moment.unix(n[t].start).date()==s&&moment.unix(n[t].start).month()==h&&(n[t].title.indexOf("Quote")>-1?(r.total=r.total+1,r.start=moment.unix(n[t].start)):n[t].title.indexOf("Home")>-1?(u.total=u.total+1,u.start=moment.unix(n[t].start)):(e.start=moment.unix(n[t].start),e.title=n[t].title,i.find("#calendar").fullCalendar("renderEvent",e,!1)));r.total>0&&(r.title=r.total+" Quotes",i.find("#calendar").fullCalendar("renderEvent",r,!1));u.total>0&&(u.title=u.total+" Surveys",i.find("#calendar").fullCalendar("renderEvent",u,!1))}}},function(){})};t.GetSchedule=function(){n.GetScheduleForQuote(t.$parent.selectedQuote.Lookup).then(function(n){t.scheduleForQuote=n},function(){alert("manageSchedule - scheduleFactory.GetScheduleForQuote")})};t.InitCalendar=function(){var n=new Date,r=n.getDate(),u=n.getMonth(),f=n.getFullYear();i.find("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},selectable:!0,selectHelper:!0,select:function(n){var e=moment(n),u=moment(n).date(),r=moment(n).month(),f=moment(n).year();r=r+1;t.selectedDate=u;t.selectedMonth=r;t.selectedYear=f;t.GetAllQuotesForDate();i.find("#calendar").fullCalendar("unselect")},editable:!0,droppable:!1,drop:function(n,t){var u=$(this).data("eventObject"),i=$.extend({},u),r;i.start=n;i.allDay=t;r=$(this).data("eventclass");r&&(i.className=r);$("#calendar").fullCalendar("renderEvent",i,!0);$("#drop-remove").is(":checked")&&$(this).remove()},events:function(n,i){var r=moment(n).format("MM/DD/YYYY"),u=moment(i).format("MM/DD/YYYY");t.getEventMonth(r,u,t.$parent.selectedQuote.FranchiseID)}})};t.Init=function(){t.InitCalendar();t.GetSchedule()};t.Init()}quoteApp.controller("manageSchedule",["scheduleFactory","$scope","$element","$window","$timeout",manageSchedule]);