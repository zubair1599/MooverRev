(function(){var f,a,t;CKEDITOR.on("dialogDefinition",function(n){var t;t=n.data.name;n=n.data.definition;"link"==t?(n.removeContents("target"),n.removeContents("upload"),n.removeContents("advanced"),t=n.getContents("info"),t.remove("emailSubject"),t.remove("emailBody")):"image"==t&&(n.removeContents("advanced"),t=n.getContents("Link"),t.remove("cmbTarget"),t=n.getContents("info"),t.remove("txtAlt"),t.remove("basic"))});var n={b:"strong",u:"u",i:"em",color:"span",size:"span",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},o={strong:"b",b:"b",u:"u",em:"i",i:"i",code:"code",li:"*"},i={strong:"b",em:"i",u:"u",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},s={color:"color",size:"font-size"},h={url:"href",email:"mailhref",quote:"cite",list:"listType"},r=CKEDITOR.dtd,c=CKEDITOR.tools.extend({table:1},r.$block,r.$listItem,r.$tableContent,r.$list),v=/\s*(?:;\s*|$)/,u={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},l={},f=[];for(var e in u)l[u[e]]=e,f.push(u[e].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(n){return"\\"+n}));f=RegExp(f.join("|"),"g");a=function(){var n=[],t={nbsp:" ",shy:"­",gt:">",lt:"<"};for(var i in t)n.push(i);return n=RegExp("&("+n.join("|")+");","g"),function(i){return i.replace(n,function(n,i){return t[i]})}}();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/ig}};CKEDITOR.BBCodeParser.prototype={parse:function(t){for(var i,r,o,a,e,u=0;i=this._.bbcPartsRegex.exec(t);){if(r=i.index,r>u)this.onText(t.substring(u,r),1);if(u=this._.bbcPartsRegex.lastIndex,(r=(i[1]||i[3]||"").toLowerCase())&&!n[r])this.onText(i[0]);else if(i[1]){var l=n[r],f={},c={};if(i=i[2])if("list"==r&&(isNaN(i)?/^[a-z]+$/.test(i)?i="lower-alpha":/^[A-Z]+$/.test(i)&&(i="upper-alpha"):i="decimal"),s[r]){"size"==r&&(i+="%");c[s[r]]=i;i=f;e="";o=void 0;for(o in c)a=(o+":"+c[o]).replace(v,";"),e=e+a;i.style=e}else h[r]&&(f[h[r]]=i);("email"==r||"img"==r)&&(f.bbcode=r);this.onTagOpen(l,f,CKEDITOR.dtd.$empty[l])}else if(i[3])this.onTagClose(n[r])}if(t.length>u)this.onText(t.substring(u,t.length),1)}};CKEDITOR.htmlParser.fragment.fromBBCode=function(n){function v(n){var t;if(0<u.length)for(t=0;t<u.length;t++){var i=u[t],f=i.name,e=CKEDITOR.dtd[f],o=r.name&&CKEDITOR.dtd[r.name];o&&!o[f]||n&&e&&!e[n]&&CKEDITOR.dtd[n]||(i=i.clone(),i.parent=r,r=i,u.splice(t,1),t--)}}function h(n,u){var e=r.children.length,f=0<e&&r.children[e-1],e=!f&&t.getRule(i[r.name],"breakAfterOpen"),f=f&&f.type==CKEDITOR.NODE_ELEMENT&&t.getRule(i[f.name],"breakAfterClose"),s=n&&t.getRule(i[n],u?"breakBeforeClose":"breakBeforeOpen");for(o&&(e||f||s)&&o--,o&&(n in c)&&o++;o&&o--;)r.children.push(new CKEDITOR.htmlParser.element("br"))}function e(n,t){h(n.name,1);var t=t||r||a,i=t.children.length;n.previous=0<i&&t.children[i-1]||null;n.parent=t;t.children.push(n);n.returnPoint&&(r=n.returnPoint,delete n.returnPoint)}var s=new CKEDITOR.BBCodeParser,a=new CKEDITOR.htmlParser.fragment,u=[],o=0,r=a,y;for(s.onTagOpen=function(n,t){var i=new CKEDITOR.htmlParser.element(n,t),o,f,c;if(CKEDITOR.dtd.$removeEmpty[n])u.push(i);else{if(o=r.name,f=o&&(CKEDITOR.dtd[o]||(r._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span)),f&&!f[n]&&(f=!1,n==o?e(r,r.parent):(n in CKEDITOR.dtd.$listItem?(s.onTagOpen("ul",{}),c=r):(e(r,r.parent),u.unshift(r)),f=!0),r=c?c:r.returnPoint||r.parent,f)){s.onTagOpen.apply(this,arguments);return}v(n);h(n);i.parent=r;i.returnPoint=y;y=0;i.isEmpty?e(i):r=i}},s.onTagClose=function(n){for(var i=u.length-1;0<=i;i--)if(n==u[i].name){u.splice(i,1);return}for(var f=[],o=[],t=r;t.type&&t.name!=n;)t._.isBlockLike||o.unshift(t),f.push(t),t=t.parent;if(t.type){for(i=0;i<f.length;i++)n=f[i],e(n,n.parent);r=t;e(t,t.parent);t==r&&(r=r.parent);u=u.concat(o)}},s.onText=function(n){var t=CKEDITOR.dtd[r.name];(!t||t["#"])&&(h(),v(),n.replace(/(\r\n|[\r\n])|[^\r\n]*/g,function(n,t){if(void 0!==t&&t.length)o++;else if(n.length){var i=0;n.replace(f,function(t,u){e(new CKEDITOR.htmlParser.text(n.substring(i,u)),r);e(new CKEDITOR.htmlParser.element("smiley",{desc:l[t]}),r);i=u+t.length});i!=n.length&&e(new CKEDITOR.htmlParser.text(n.substring(i,n.length)),r)}}))},s.parse(CKEDITOR.tools.htmlEncode(n));r.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT;)n=r.parent,e(r,n),r=n;return a};t=new(CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]};this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0});this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(n,t){var i=this._.rules[n];i?CKEDITOR.tools.extend(i,t,!0):this._.rules[n]=t},getRule:function(n,t){return this._.rules[n]&&this._.rules[n][t]},openTag:function(t){t in n&&(this.getRule(t,"breakBeforeOpen")&&this.lineBreak(1),this.write("[",t))},openTagClose:function(t){"br"==t?this._.output.push("\n"):t in n&&(this.write("]"),this.getRule(t,"breakAfterOpen")&&this.lineBreak(1))},attribute:function(n,t){"option"==n&&("string"==typeof t&&(t=t.replace(/&amp;/g,"&")),this.write("=",t))},closeTag:function(t){t in n&&(this.getRule(t,"breakBeforeClose")&&this.lineBreak(1),"*"!=t&&this.write("[/",t,"]"),this.getRule(t,"breakAfterClose")&&this.lineBreak(1))},text:function(n){this.write(n)},comment:function(){},lineBreak:function(){!this._.hasLineBreak&&this._.output.length&&(this.write("\n"),this._.hasLineBreak=1)},write:function(){this._.hasLineBreak=0;this._.output.push(Array.prototype.join.call(arguments,""))},reset:function(){this._.output=[];this._.hasLineBreak=0},getHtml:function(n){var t=this._.output.join("");return n&&this.reset(),a(t)}}}));CKEDITOR.plugins.add("bbcode",{requires:"entities",beforeInit:function(n){CKEDITOR.tools.extend(n.config,{enterMode:CKEDITOR.ENTER_BR,basicEntities:!1,entities:!1,fillEmptyBlocks:!1},!0);n.filter.disable()},init:function(n){function r(n){var i=n.data,n=CKEDITOR.htmlParser.fragment.fromBBCode(n.data.dataValue),t=new CKEDITOR.htmlParser.basicWriter;n.writeHtml(t,f);n=t.getHtml(!0);i.dataValue=n}var i=n.config,f=new CKEDITOR.htmlParser.filter;if(f.addRules({elements:{blockquote:function(n){var t=new CKEDITOR.htmlParser.element("div"),i;t.children=n.children;n.children=[t];(t=n.attributes.cite)&&(i=new CKEDITOR.htmlParser.element("cite"),i.add(new CKEDITOR.htmlParser.text(t.replace(/^"|"$/g,""))),delete n.attributes.cite,n.children.unshift(i))},span:function(n){var t;(t=n.attributes.bbcode)&&("img"==t?(n.name="img",n.attributes.src=n.children[0].value,n.children=[]):"email"==t&&(n.name="a",n.attributes.href="mailto:"+n.children[0].value),delete n.attributes.bbcode)},ol:function(n){n.attributes.listType?"decimal"!=n.attributes.listType&&(n.attributes.style="list-style-type:"+n.attributes.listType):n.name="ul";delete n.attributes.listType},a:function(n){n.attributes.href||(n.attributes.href=n.children[0].value)},smiley:function(n){n.name="img";var t=n.attributes.desc,r=i.smiley_images[CKEDITOR.tools.indexOf(i.smiley_descriptions,t)],r=CKEDITOR.tools.htmlEncode(i.smiley_path+r);n.attributes={src:r,"data-cke-saved-src":r,title:t,alt:t}}}}),n.dataProcessor.htmlFilter.addRules({elements:{$:function(t){var f=t.attributes,e=CKEDITOR.tools.parseCssText(f.style,1),i,r=t.name;if(r in o)r=o[r];else if("span"==r)(i=e.color)?(r="color",i=CKEDITOR.tools.convertRgbToHex(i)):(i=e["font-size"])&&(f=i.match(/(\d+)%$/))&&(i=f[1],r="size");else if("ol"==r||"ul"==r){if(i=e["list-style-type"])switch(i){case"lower-alpha":i="a";break;case"upper-alpha":i="A"}else"ol"==r&&(i=1);r="list"}else if("blockquote"==r){try{var s=t.children[0],c=t.children[1],h="cite"==s.name&&s.children[0].value;h&&(i='"'+h+'"',t.children=c.children)}catch(l){}r="quote"}else if("a"==r)(i=f.href)&&(-1!==i.indexOf("mailto:")?(r="email",t.children=[new CKEDITOR.htmlParser.text(i.replace("mailto:",""))],i=""):((r=1==t.children.length&&t.children[0])&&r.type==CKEDITOR.NODE_TEXT&&r.value==i&&(i=""),r="url"));else if("img"==r){if(t.isEmpty=0,e=f["data-cke-saved-src"]||f.src,f=f.alt,e&&-1!=e.indexOf(n.config.smiley_path)&&f)return new CKEDITOR.htmlParser.text(u[f]);t.children=[new CKEDITOR.htmlParser.text(e)]}return t.name=r,i&&(t.attributes.option=i),null},br:function(n){if((n=n.next)&&n.name in c)return!1}}},1),n.dataProcessor.writer=t,n.elementMode==CKEDITOR.ELEMENT_MODE_INLINE)n.once("contentDom",function(){n.on("setData",r)});else n.on("setData",r)},afterInit:function(n){var t;n._.elementsPath&&(t=n._.elementsPath.filters)&&t.push(function(t){var u=t.getName(),r=i[u]||!1;return"link"==r&&0===t.getAttribute("href").indexOf("mailto:")?r="email":"span"==u?t.getStyle("font-size")?r="size":t.getStyle("color")&&(r="color"):"img"==r&&(t=t.data("cke-saved-src")||t.getAttribute("src"))&&0===t.indexOf(n.config.smiley_path)&&(r="smiley"),r})}})})();