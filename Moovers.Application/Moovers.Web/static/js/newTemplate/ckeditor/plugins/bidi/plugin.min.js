(function(){function i(n,t,i,r){if(!n.isReadOnly()&&!n.equals(i.editable())){CKEDITOR.dom.element.setMarker(r,n,"bidi_processed",1);for(var r=n,u=i.editable();(r=r.getParent())&&!r.equals(u);)if(r.getCustomData("bidi_processed")){n.removeStyle("direction");n.removeAttribute("dir");return}r="useComputedState"in i.config?i.config.useComputedState:1;(r?n.getComputedStyle("direction"):n.getStyle("direction")||n.hasAttribute("dir"))!=t&&(n.removeStyle("direction"),r?(n.removeAttribute("dir"),t!=n.getComputedStyle("direction")&&n.setAttribute("dir",t)):n.setAttribute("dir",t),i.forceNextSelectionCheck())}}function s(n,t,i){var r=n.getCommonAncestor(!1,!0),n=n.clone(),u;if(n.enlarge(i==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),n.checkBoundaryOfElement(r,CKEDITOR.START)&&n.checkBoundaryOfElement(r,CKEDITOR.END)){for(;r&&r.type==CKEDITOR.NODE_ELEMENT&&(u=r.getParent())&&1==u.getChildCount()&&!(r.getName()in t);)r=u;return r.type==CKEDITOR.NODE_ELEMENT&&r.getName()in t&&r}}function e(n){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(n,t){var r=n.config.useComputedState,i,r=void 0===r||r,u,f;if(!r)for(i=t.lastElement,u=n.editable();i&&!(i.getName()in o||i.equals(u));){if(f=i.getParent(),!f)break;i=f}i=i||t.block||t.blockLimit;i.equals(n.editable())&&(u=n.getSelection().getRanges()[0].getEnclosedNode())&&u.type==CKEDITOR.NODE_ELEMENT&&(i=u);i&&(r=r?i.getComputedStyle("direction"):i.getStyle("direction")||i.getAttribute("dir"),n.getCommand("bidirtl").setState("rtl"==r?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),n.getCommand("bidiltr").setState("ltr"==r?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF));r=(t.block||t.blockLimit||n.editable()).getDirection(1);r!=(n._.selDir||n.lang.dir)&&(n._.selDir=r,n.fire("contentDirChanged",r))},exec:function(t){var l=t.getSelection(),o=t.config.enterMode,h=l.getRanges(),f;if(h&&h.length){for(var c={},a=l.createBookmarks(),h=h.createIterator(),e,v=0;e=h.getNextRange(1);){f=e.getEnclosedNode();f&&(!f||f.type==CKEDITOR.NODE_ELEMENT&&f.getName()in u)||(f=s(e,r,o));f&&i(f,n,t,c);var y=new CKEDITOR.dom.walker(e),p=a[v].startNode,w=a[v++].endNode;for(y.evaluator=function(n){return!!(n.type==CKEDITOR.NODE_ELEMENT&&n.getName()in r&&!(n.getName()==(o==CKEDITOR.ENTER_P?"p":"div")&&n.getParent().type==CKEDITOR.NODE_ELEMENT&&"blockquote"==n.getParent().getName())&&n.getPosition(p)&CKEDITOR.POSITION_FOLLOWING&&(n.getPosition(w)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};f=y.next();)i(f,n,t,c);for(e=e.createIterator(),e.enlargeBr=o!=CKEDITOR.ENTER_BR;f=e.getNextParagraph(o==CKEDITOR.ENTER_P?"p":"div");)i(f,n,t,c)}CKEDITOR.dom.element.clearAllMarkers(c);t.forceNextSelectionCheck();l.selectBookmarks(a);t.focus()}}}}function h(t){var r=t==n.setAttribute,i=t==n.removeAttribute,u=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(n,f){var e,o;if(!this.isReadOnly()){if(e=n==(r||i?"dir":"direction")||"style"==n&&(i||u.test(f))){n:{for(e=this,o=e.getDocument().getBody().getParent();e;){if(e.equals(o)){e=!1;break n}e=e.getParent()}e=!0}e=!e}if(e&&(e=this.getDirection(1),o=t.apply(this,arguments),e!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),o}return t.apply(this,arguments)}}var r={table:1,ul:1,ol:1,blockquote:1,div:1},u={},o={};CKEDITOR.tools.extend(u,r,{tr:1,p:1,div:1,li:1});CKEDITOR.tools.extend(o,u,{td:1});CKEDITOR.plugins.add("bidi",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",icons:"bidiltr,bidirtl",hidpi:!0,init:function(n){function t(t,i,r,u,f){n.addCommand(r,new CKEDITOR.command(n,u));n.ui.addButton&&n.ui.addButton(t,{label:i,command:r,toolbar:"bidi,"+f})}if(!n.blockless){var i=n.lang.bidi;t("BidiLtr",i.ltr,"bidiltr",e("ltr"),10);t("BidiRtl",i.rtl,"bidirtl",e("rtl"),20);n.on("contentDom",function(){n.document.on("dirChanged",function(t){n.fire("dirChanged",{node:t.data,dir:t.data.getDirection(1)})})});n.on("contentDirChanged",function(t){var t=(n.lang.dir!=t.data?"add":"remove")+"Class",i=n.ui.space(n.config.toolbarLocation);i&&i[t]("cke_mixed_dir_content")})}}});for(var n=CKEDITOR.dom.element.prototype,f=["setStyle","removeStyle","setAttribute","removeAttribute"],t=0;t<f.length;t++)n[f[t]]=CKEDITOR.tools.override(n[f[t]],h)})();